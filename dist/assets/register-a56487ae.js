import{t as h,d7 as x,r as S,bt as C,bH as N,bI as R,bJ as $,bK as d,bs as o,bP as r,bL as a,aW as u,cf as m,bW as p,aI as I,D as K,bN as E,bR as T}from"./index-8d305a84.js";import{a as V}from"./auth-7adda57d.js";import{i as b,a as q}from"./common-fdac4b74.js";import{u as D}from"./useSmsLock-83bdc066.js";import{a as f,N as U}from"./FormItem-742d2080.js";const B={class:"el-container is-vertical login-box reister"},z={class:"el-main",style:{padding:"3px"}},F={class:"helper"},L=h({__name:"register",setup(M){const{lockTime:g,start:_}=D("REGISTER_SMS",60),c=x(),w=S(),v={nickname:{required:!0,trigger:["blur","input"],message:"昵称不能为空！"},username:{required:!0,validator(t,e){if(e){if(!b(e))return new Error("请正确填写手机号！")}else return new Error("手机号不能为空！");return!0},trigger:["blur","input"]},password:{required:!0,trigger:["blur","input"],message:"密码不能为空！"},sms_code:{required:!0,trigger:["blur","input"],message:"验证码不能为空！"}},s=C({nickname:"",username:"",password:"",sms_code:"",loading:!1}),k=()=>{s.loading=!0;const t=V({nickname:s.nickname,mobile:s.username,password:s.password,sms_code:s.sms_code,platform:"web"});t.then(e=>{e.code==200?(window.$message.success("注册成功"),setTimeout(()=>{c.push("/auth/login")},500)):window.$message.warning(e.message)}),t.finally(()=>{s.loading=!1})},l=t=>{t.preventDefault(),w.value.validate(e=>{!e&&k()})},y=()=>{if(!b(s.username)){window.$message.warning("请正确填写手机号");return}const t=q({mobile:s.username,channel:"register"});t.then(e=>{e.code==200?(_(),window.$message.success("短信发送成功"),e.data.is_debug&&(s.sms_code=e.data.sms_code,setTimeout(()=>{window.$message.success("已开启验证码自动填充")},1e3))):window.$message.warning(e.message)}),t.finally(()=>{s.loading=!1})};return(t,e)=>{const i=N("n-button");return R(),$("section",B,[e[10]||(e[10]=d("header",{class:"el-header box-header"},"账号注册",-1)),d("main",z,[o(a(U),{ref_key:"formRef",ref:w,size:"large",model:s,rules:v},{default:r(()=>[o(a(f),{path:"username","show-label":!1},{default:r(()=>[o(a(u),{placeholder:"请输入手机号",value:s.username,"onUpdate:value":e[0]||(e[0]=n=>s.username=n),maxlength:11,onKeydown:m(l,["enter"])},null,8,["value"])]),_:1}),o(a(f),{path:"sms_code","show-label":!1},{default:r(()=>[o(a(u),{placeholder:"验证码",value:s.sms_code,"onUpdate:value":e[1]||(e[1]=n=>s.sms_code=n),maxlength:6,onKeydown:m(l,["enter"])},null,8,["value"]),o(i,{tertiary:"",class:"mt-l5",onClick:y,disabled:a(g)>0},{default:r(()=>[e[6]||(e[6]=p(" 获取验证码 ")),I(d("span",null,"("+E(a(g))+"s)",513),[[K,a(g)>0]])]),_:1},8,["disabled"])]),_:1}),o(a(f),{path:"nickname","show-label":!1},{default:r(()=>[o(a(u),{placeholder:"设置昵称",value:s.nickname,"onUpdate:value":e[2]||(e[2]=n=>s.nickname=n),onKeydown:m(l,["enter"])},null,8,["value"])]),_:1}),o(a(f),{path:"password","show-label":!1},{default:r(()=>[o(a(u),{placeholder:"设置密码",type:"password","show-password-on":"click",value:s.password,"onUpdate:value":e[3]||(e[3]=n=>s.password=n),onKeydown:m(l,["enter"])},null,8,["value"])]),_:1}),o(i,{type:"primary",size:"large",block:"",class:"mt-t20",onClick:l,loading:s.loading},{default:r(()=>e[7]||(e[7]=[p(" 立即注册 ")])),_:1},8,["loading"])]),_:1},8,["model"]),d("div",F,[o(i,{text:"",color:"#646cff",onClick:e[4]||(e[4]=n=>a(c).push("/auth/forget"))},{default:r(()=>e[8]||(e[8]=[p(" 找回密码 ")])),_:1}),o(i,{text:"",color:"#646cff",onClick:e[5]||(e[5]=n=>a(c).push("/auth/login"))},{default:r(()=>e[9]||(e[9]=[p(" 已有账号，立即登录? ")])),_:1})])])])}}});const j=T(L,[["__scopeId","data-v-15e30a6f"]]);export{j as default};
