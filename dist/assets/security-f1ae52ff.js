import{t as k,r as g,bt as h,bI as x,bO as E,bP as n,bK as d,bs as s,bW as c,bL as a,aY as q,aW as y,c1 as U,dl as D,bH as N,aI as I,D as R,bN as C,dm as P,dn as L,cN as A,bJ as F,ae as H,bR as T}from"./index-8d305a84.js";import{a as V,N as M}from"./FormItem-742d2080.js";import{S as B,i as G,a as O,b as W}from"./common-fdac4b74.js";import{h as J}from"./strings-8042df5b.js";const K={style:{width:"100%","text-align":"right"}},Y=k({__name:"EditorPassword",props:["modelValue"],emits:["update:modelValue","close"],setup($,{emit:_}){const b=_,w=g(),o=h({old_password:"",new_password:"",new_password2:""}),S={old_password:{required:!0,trigger:["blur","input"],message:"登录密码不能为空！"},new_password:{required:!0,trigger:["blur","input"],message:"新密码不能为空！"},new_password2:{required:!0,trigger:["blur","change"],validator(p,t){if(console.log(p),t){if(o.new_password!=o.new_password2)return new Error("两次密码填写不一致！")}else return new Error("确认密码不能为空！");return!0}}},i=g(!1),v=()=>{i.value=!0;let p=D({old_password:o.old_password,new_password:o.new_password});p.then(t=>{t.code==200?(window.$message.success("密码修改成功"),b("update:modelValue",!1)):window.$message.warning(t.message)}),p.finally(()=>{i.value=!1})},l=p=>{p.preventDefault(),w.value.validate(t=>{!t&&v()})};return(p,t)=>(x(),E(a(U),{show:$.modelValue,preset:"card",title:"修改密码？",class:"modal-radius",style:{"max-width":"400px"},"on-update:show":f=>{p.$emit("update:modelValue",f)}},{footer:n(()=>[d("div",K,[s(a(q),{type:"tertiary",onClick:t[3]||(t[3]=f=>p.$emit("update:modelValue",!1))},{default:n(()=>t[4]||(t[4]=[c(" 取消 ")])),_:1}),s(a(q),{type:"primary",class:"mt-l15",loading:i.value,onClick:l},{default:n(()=>t[5]||(t[5]=[c(" 保存修改 ")])),_:1},8,["loading"])])]),default:n(()=>[s(a(M),{ref_key:"formRef",ref:w,model:o,rules:S},{default:n(()=>[s(a(V),{label:"登录密码",path:"old_password"},{default:n(()=>[s(a(y),{placeholder:"请填写登录密码",type:"password",value:o.old_password,"onUpdate:value":t[0]||(t[0]=f=>o.old_password=f)},null,8,["value"])]),_:1}),s(a(V),{label:"设置新密码",path:"new_password"},{default:n(()=>[s(a(y),{placeholder:"请填写新密码",type:"password",value:o.new_password,"onUpdate:value":t[1]||(t[1]=f=>o.new_password=f)},null,8,["value"])]),_:1}),s(a(V),{label:"确认新密码",path:"new_password2"},{default:n(()=>[s(a(y),{placeholder:"请再次填写新密码",type:"password",value:o.new_password2,"onUpdate:value":t[2]||(t[2]=f=>o.new_password2=f)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","on-update:show"]))}}),j={style:{width:"100%","text-align":"right"}},z=k({__name:"EditorMobile",props:["modelValue"],emits:["update:modelValue","success"],setup($,{emit:_}){const b=_,w=g(),o=h({password:"",mobile:"",sms_code:""}),S={password:{required:!0,trigger:["input"],message:"账号密码不能为空！"},mobile:{required:!0,trigger:["input"],message:"手机号不能为空！"},sms_code:{required:!0,trigger:["change"],message:"验证码不能为空！"}},i=g(!1),v=g(0),l=new B("CHANGE_MOBILE_SMS",120,r=>v.value=r),p=()=>{if(!G(o.mobile)){window.$message.warning("请正确填写手机号");return}O({mobile:o.mobile,channel:"change_account"}).then(({code:e,data:m,message:u})=>{e==200?(l.start(),m.is_debug?(o.sms_code=m.sms_code,window.$message.success("已开启验证码自动填充")):window.$message.success("短信发送成功")):window.$message.warning(u)})},t=()=>{i.value=!0;let r=P(o);r.then(({code:e,message:m})=>{e==200?(window.$message.success("手机号修改成功..."),b("success",o.mobile)):window.$message.warning(m)}),r.finally(()=>{i.value=!1})},f=r=>{r.preventDefault(),w.value.validate(e=>{!e&&t()})};return(r,e)=>{const m=N("n-button");return x(),E(a(U),{show:$.modelValue,preset:"card",title:"换绑手机？",class:"modal-radius",style:{"max-width":"400px"},"on-update:show":u=>{r.$emit("update:modelValue",u)}},{footer:n(()=>[d("div",j,[s(m,{type:"tertiary",onClick:e[3]||(e[3]=u=>r.$emit("update:modelValue",!1))},{default:n(()=>e[5]||(e[5]=[c(" 取消 ")])),_:1}),s(m,{type:"primary",class:"mt-l15",loading:i.value,onClick:f},{default:n(()=>e[6]||(e[6]=[c(" 保存修改 ")])),_:1},8,["loading"])])]),default:n(()=>[s(a(M),{ref_key:"formRef",ref:w,model:o,rules:S},{default:n(()=>[s(a(V),{label:"登录密码",path:"password"},{default:n(()=>[s(a(y),{placeholder:"请填写登录密码",type:"password",value:o.password,"onUpdate:value":e[0]||(e[0]=u=>o.password=u)},null,8,["value"])]),_:1}),s(a(V),{label:"新手机号码",path:"mobile"},{default:n(()=>[s(a(y),{placeholder:"请填写新手机号码",type:"text",value:o.mobile,"onUpdate:value":e[1]||(e[1]=u=>o.mobile=u)},null,8,["value"])]),_:1}),s(a(V),{label:"短信验证码",path:"sms_code"},{default:n(()=>[s(a(y),{placeholder:"请填写验证码",type:"text",value:o.sms_code,"onUpdate:value":e[2]||(e[2]=u=>o.sms_code=u)},null,8,["value"]),s(m,{tertiary:"",class:"mt-l5",onClick:p,disabled:v.value>0},{default:n(()=>[e[4]||(e[4]=c(" 获取验证码 ")),I(d("span",null,"("+C(v.value)+"s)",513),[[R,v.value>0]])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","on-update:show"])}}}),Q={style:{width:"100%","text-align":"right"}},X=k({__name:"EditorEmail",props:["modelValue"],emits:["update:modelValue","success"],setup($,{emit:_}){const b=_,w=g(0),o=new B("CHANGE_EMAIL_SMS",120,r=>w.value=r),S=g(),i=h({password:"",email:"",code:""}),v={password:{required:!0,trigger:["input"],message:"账号密码不能为空！"},email:{required:!0,trigger:["input"],message:"邮箱不能为空！"},code:{required:!0,trigger:["change"],message:"验证码不能为空！"}},l=g(!1),p=()=>{W({email:i.email}).then(({code:e,message:m})=>{e==200?(o.start(),window.$message.success("邮件发送成功")):window.$message.warning(m)})},t=()=>{l.value=!0;let r=L(i);r.then(({code:e,message:m})=>{e==200?(window.$message.success("密码修改成功..."),b("success",i.email)):window.$message.warning(m)}),r.finally(()=>{l.value=!1})},f=r=>{r.preventDefault(),S.value.validate(e=>{!e&&t()})};return(r,e)=>{const m=N("n-button");return x(),E(a(U),{show:$.modelValue,preset:"card",title:"修改邮箱？",class:"modal-radius",style:{"max-width":"400px"},"on-update:show":u=>{r.$emit("update:modelValue",u)}},{footer:n(()=>[d("div",Q,[s(m,{type:"tertiary",onClick:e[3]||(e[3]=u=>r.$emit("update:modelValue",!1))},{default:n(()=>e[5]||(e[5]=[c(" 取消 ")])),_:1}),s(m,{type:"primary",class:"mt-l15",loading:l.value,onClick:f},{default:n(()=>e[6]||(e[6]=[c(" 保存修改 ")])),_:1},8,["loading"])])]),default:n(()=>[s(a(M),{ref_key:"formRef",ref:S,model:i,rules:v},{default:n(()=>[s(a(V),{label:"登录密码",path:"password"},{default:n(()=>[s(a(y),{placeholder:"请填写登录密码",type:"password",value:i.password,"onUpdate:value":e[0]||(e[0]=u=>i.password=u)},null,8,["value"])]),_:1}),s(a(V),{label:"新邮箱",path:"email"},{default:n(()=>[s(a(y),{placeholder:"请填写新邮箱",type:"text",value:i.email,"onUpdate:value":e[1]||(e[1]=u=>i.email=u)},null,8,["value"])]),_:1}),s(a(V),{label:"邮箱验证码",path:"code"},{default:n(()=>[s(a(y),{placeholder:"请填写验证码",type:"text",value:i.code,"onUpdate:value":e[2]||(e[2]=u=>i.code=u)},null,8,["value"]),s(m,{tertiary:"",class:"mt-l5",onClick:p,disabled:w.value>0},{default:n(()=>[e[4]||(e[4]=c(" 获取验证码 ")),I(d("span",null,"("+C(w.value)+"s)",513),[[R,w.value>0]])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","on-update:show"])}}}),Z={class:"view-box"},ee={class:"view-list"},se={class:"tools"},le={class:"view-list"},te={class:"content"},oe={class:"desc"},ae={class:"tools"},ne={class:"view-list"},de={class:"content"},re={class:"desc"},ie={class:"tools"},ue=k({__name:"security",setup($){const _=A(),b=g(!1),w=g(!1),o=g(!1),S=v=>{w.value=!1,_.mobile=v},i=v=>{o.value=!1,_.email=v};return(v,l)=>{const p=N("n-button");return x(),F(H,null,[d("section",null,[l[12]||(l[12]=d("h3",{class:"title"},"安全设置",-1)),d("div",Z,[d("div",ee,[l[7]||(l[7]=d("div",{class:"content"},[d("div",{class:"name"},"账户密码"),d("div",{class:"desc"},"当前密码强度 ：中")],-1)),d("div",se,[s(p,{type:"primary",text:"",onClick:l[0]||(l[0]=t=>b.value=!0)},{default:n(()=>l[6]||(l[6]=[c(" 修改 ")])),_:1})])]),d("div",le,[d("div",te,[l[8]||(l[8]=d("div",{class:"name"},"绑定手机",-1)),d("div",oe,"已绑定手机 ："+C(a(J)(a(_).mobile)),1)]),d("div",ae,[s(p,{type:"primary",text:"",onClick:l[1]||(l[1]=t=>w.value=!0)},{default:n(()=>l[9]||(l[9]=[c(" 修改 ")])),_:1})])]),d("div",ne,[d("div",de,[l[10]||(l[10]=d("div",{class:"name"},"绑定邮箱",-1)),d("div",re,"已绑定邮箱 ："+C(a(_).email||"未设置"),1)]),d("div",ie,[s(p,{type:"primary",text:"",onClick:l[2]||(l[2]=t=>o.value=!0)},{default:n(()=>l[11]||(l[11]=[c(" 修改 ")])),_:1})])])])]),s(Y,{modelValue:b.value,"onUpdate:modelValue":l[3]||(l[3]=t=>b.value=t)},null,8,["modelValue"]),s(z,{modelValue:w.value,"onUpdate:modelValue":l[4]||(l[4]=t=>w.value=t),onSuccess:S},null,8,["modelValue"]),s(X,{modelValue:o.value,"onUpdate:modelValue":l[5]||(l[5]=t=>o.value=t),onSuccess:i},null,8,["modelValue"])],64)}}});const fe=T(ue,[["__scopeId","data-v-7711b0bf"]]);export{fe as default};
