import{t as x,d7 as k,r as S,bt as C,bH as N,bI as $,bJ as F,bK as i,bs as t,bP as r,bL as o,aW as f,cf as g,bW as u,aI as I,D as K,bN as R,bR as V}from"./index-8d305a84.js";import{b as D}from"./auth-7adda57d.js";import{i as _,a as E}from"./common-fdac4b74.js";import{u as T}from"./useSmsLock-83bdc066.js";import{a as w,N as q}from"./FormItem-742d2080.js";const B={class:"el-container is-vertical login-box forget"},P={class:"el-main",style:{padding:"3px"}},U={class:"helper"},W=x({__name:"forget",setup(z){const{lockTime:m,start:b}=T("FORGET_PSW_SMS",120),p=k(),c=S(),v={sms_code:{required:!0,trigger:["blur","input"],message:"验证码不能为空！"},username:{required:!0,trigger:["blur","input"],validator(a,e){if(e){if(!_(e))return new Error("请正确填写手机号！")}else return new Error("手机号不能为空！");return!0}},password:{required:!0,trigger:["blur","input"],message:"密码不能为空！"}},s=C({username:"",password:"",sms_code:"",loading:!1}),y=()=>{s.loading=!0;const a=D({mobile:s.username,password:s.password,sms_code:s.sms_code});a.then(e=>{e.code==200?(window.$message.success("密码修改成功"),setTimeout(()=>{p.push("/auth/login")},500)):window.$message.warning(e.message)}),a.finally(()=>{s.loading=!1})},l=a=>{a.preventDefault(),c.value.validate(e=>{!e&&y()})},h=()=>{if(!_(s.username)){window.$message.warning("请正确填写手机号");return}const a=E({mobile:s.username,channel:"forget_account"});a.then(e=>{e.code==200?(b(),window.$message.success("短信发送成功")):window.$message.warning(e.message)}),a.finally(()=>{s.loading=!1})};return(a,e)=>{const d=N("n-button");return $(),F("section",B,[e[9]||(e[9]=i("header",{class:"el-header box-header"},"找回密码",-1)),i("main",P,[t(o(q),{ref_key:"formRef",ref:c,size:"large",model:s,rules:v},{default:r(()=>[t(o(w),{path:"username","show-label":!1},{default:r(()=>[t(o(f),{placeholder:"登录账号/手机号",value:s.username,"onUpdate:value":e[0]||(e[0]=n=>s.username=n),maxlength:11,onKeydown:g(l,["enter"])},null,8,["value"])]),_:1}),t(o(w),{path:"sms_code","show-label":!1},{default:r(()=>[t(o(f),{placeholder:"验证码",maxlength:6,value:s.sms_code,"onUpdate:value":e[1]||(e[1]=n=>s.sms_code=n),onKeydown:g(l,["enter"])},null,8,["value"]),t(d,{tertiary:"",class:"mt-l5",onClick:h,disabled:o(m)>0},{default:r(()=>[e[5]||(e[5]=u(" 获取验证码 ")),I(i("span",null,"("+R(o(m))+"s)",513),[[K,o(m)>0]])]),_:1},8,["disabled"])]),_:1}),t(o(w),{path:"password","show-label":!1},{default:r(()=>[t(o(f),{placeholder:"设置密码",type:"password","show-password-on":"click",value:s.password,"onUpdate:value":e[2]||(e[2]=n=>s.password=n),onKeydown:g(l,["enter"])},null,8,["value"])]),_:1}),t(d,{type:"primary",size:"large",block:"",class:"mt-t20",onClick:l,loading:s.loading},{default:r(()=>e[6]||(e[6]=[u(" 立即找回 ")])),_:1},8,["loading"])]),_:1},8,["model"]),i("div",U,[t(d,{text:"",color:"#646cff",onClick:e[3]||(e[3]=n=>o(p).push("/auth/register"))},{default:r(()=>e[7]||(e[7]=[u(" 注册账号 ")])),_:1}),t(d,{text:"",color:"#646cff",onClick:e[4]||(e[4]=n=>o(p).push("/auth/login"))},{default:r(()=>e[8]||(e[8]=[u(" 已有账号，立即登录? ")])),_:1})])])])}}});const O=V(W,[["__scopeId","data-v-f5383d14"]]);export{O as default};
