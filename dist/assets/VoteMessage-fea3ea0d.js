import{bR as V,r as S,cN as M,bt as E,p as g,w as j,bH as B,bI as r,bJ as d,bK as t,bN as a,bL as l,ae as u,bT as y,bs as p,bM as H,bP as I,bW as O,eH as U}from"./index-8d305a84.js";import{N as L}from"./Progress-4e1b0ee7.js";import{N as P}from"./Checkbox-f0418712.js";const T={class:"im-message-vote"},$={class:"vote-from"},z={class:"vheader"},D={style:{"font-weight":"bold"}},F={class:"vbody"},J={class:"vote-option"},K={class:"vote-census"},R={class:"vote-progress"},W={class:"vfooter vote-view"},q={class:"vbody"},A={class:"checkbox"},G=["onClick"],Q={class:"vfooter"},X={__name:"VoteMessage",props:{extra:Object,data:Object},setup(x){const h=x,c=S(h.extra),k=M(),_=c.value.detail.answer_mode,i=E({options:[]}),m=g(()=>i.options.some(s=>s.is_checked)),w=g(()=>c.value.vote_users.some(s=>s==k.uid));function C(s){for(const o of s)i.options.push({key:o.key,value:o.value,is_checked:!1,num:0,progress:0})}function f(s){let o=s.count;i.options.forEach(n=>{n.num=s.options[n.key],o>0&&(n.progress=s.options[n.key]/o*100)})}function b(s,o){_==0&&i.options.forEach(n=>n.is_checked=!1),o.is_checked=s}const N=()=>{if(!m.value)return;let s=[];i.options.forEach(o=>{o.is_checked&&s.push(o.key)}),U({msg_id:h.data.msg_id,options:s.join(",")}).then(o=>{o.code==200&&(f(o.data),c.value.vote_users.push(k.uid),c.value.detail.answered_num++)})};return j(()=>{C(c.value.detail.answer_option),f(c.value.statistics)}),(s,o)=>{const n=B("n-button");return r(),d("section",T,[t("div",$,[t("div",z,[t("p",D,a(l(_)==1?"[多选投票]":"[单选投票]"),1),t("p",null,a(c.value.detail.title),1)]),w.value?(r(),d(u,{key:0},[t("div",F,[(r(!0),d(u,null,y(i.options,e=>(r(),d("div",{class:"vote-view",key:e.key},[t("p",J,a(e.key)+"、 "+a(e.value),1),t("p",K,a(e.num)+" 票 "+a(e.progress)+"%",1),t("p",R,[p(l(L),{type:"line",height:5,"show-indicator":!1,percentage:parseInt(e.progress),color:"#1890ff"},null,8,["percentage"])])]))),128))]),t("div",W,[t("p",null,"应参与人数："+a(c.value.detail.answer_num)+" 人",1),t("p",null,"实际参与人数："+a(c.value.detail.answered_num)+" 人",1)])],64)):(r(),d(u,{key:1},[t("div",q,[(r(!0),d(u,null,y(i.options,e=>(r(),d("div",{class:H(["option",{radio:l(_)==0}]),key:e.key},[t("p",A,[p(l(P),{checked:e.is_checked,"onUpdate:checked":[v=>e.is_checked=v,v=>b(e.is_checked,e)]},null,8,["checked","onUpdate:checked"])]),t("p",{class:"text",onClick:v=>b(!e.is_checked,e)},a(e.key)+"、"+a(e.value),9,G)],2))),128))]),t("div",Q,[p(n,{plain:"",round:"",onClick:N},{default:I(()=>[O(a(m.value?"立即投票":"请选择进行投票"),1)]),_:1})])],64))])])}}},se=V(X,[["__scopeId","data-v-d3ba9cae"]]);export{se as default};
