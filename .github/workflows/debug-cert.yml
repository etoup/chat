name: üîç Debug Apple Certificate

on:
  workflow_dispatch:  # ÂÖÅËÆ∏ÊâãÂä®Ëß¶Âèë

jobs:
  debug:
    runs-on: macos-latest
    steps:
      - name: Debug password length (safe)
        run: |
          PW="${{ secrets.APPLE_CERTIFICATE_PASSWORD }}"
          echo "Password length: ${#PW}"
          if [ ${#PW} -eq 0 ]; then
            echo "‚ùó Password is empty!"
            exit 1
          fi
      - name: Decode certificate from secret
        run: |
          printf "%s" "${{ secrets.APPLE_CERTIFICATE }}" | base64 --decode > signing.p12
          echo "‚úÖ Decoded signing.p12 successfully"

      - name: Check file integrity
        run: |
          FILE_SIZE=$(wc -c < signing.p12)
          SHA256=$(shasum -a 256 signing.p12 | cut -d' ' -f1)
          echo "üìÑ File size: $FILE_SIZE bytes"
          echo "üîë SHA256: $SHA256"

      - name: Test password with OpenSSL
        run: |
          if timeout 5 openssl pkcs12 -in signing.p12 -nokeys -passin "pass:${{ secrets.APPLE_CERTIFICATE_PASSWORD }}" >/dev/null 2>&1; then
            echo "‚úÖ Password is correct and certificate is valid"
          else
            echo "‚ùå Failed to decrypt ‚Äî wrong password or corrupted file"
            exit 1
          fi